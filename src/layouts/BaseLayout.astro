---
import type { Locale } from '@/utils/i18n';
import type { SEOProps } from '@/utils/seo';
import SEO from '@/components/SEO.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';

export interface Props extends SEOProps {
  class?: string;
}

const { class: className, ...seoProps } = Astro.props;
---

<!doctype html>
<html lang={seoProps.locale} class="h-full">
  <head>
    <SEO {...seoProps} />
    <!-- Theme initialization script (must run before body rendering) -->
    <script is:inline>
      (function() {
        function getTheme() {
          if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
            return localStorage.getItem('theme');
          }
          if (typeof window !== 'undefined' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            return 'dark';
          }
          return 'light';
        }

        function setTheme(theme) {
          if (theme === 'dark') {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.remove('dark');
          }
        }

        const theme = getTheme();
        setTheme(theme);
      })();
    </script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Preload critical fonts for better performance -->
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Noto+Sans+JP:wght@400;500;600&family=Source+Sans+3:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap">
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;1,400;1,500&family=Noto+Sans+JP:wght@400;500;600&family=Source+Sans+3:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
  </head>
  <body class={`min-h-full bg-warm-50 dark:bg-dark-50 text-warm-900 dark:text-dark-900 font-sans antialiased transition-colors duration-200 ${className || ''}`}>
    <div class="flex flex-col min-h-screen">
      <Header locale={seoProps.locale} />
      <main class="flex-1">
        <slot />
      </main>
      <Footer locale={seoProps.locale} />
    </div>
  </body>
</html>

<style is:global>
  html {
    font-family: 'Source Sans 3', 'Noto Sans JP', system-ui, sans-serif;
  }

  body {
    line-height: 1.6;
  }

  /* Typography hierarchy */
  h1, h2, h3, h4, h5, h6 {
    font-family: 'Source Sans 3', 'Noto Sans JP', system-ui, sans-serif;
    font-weight: 500;
  }

  /* Use serif font for article content and longer text blocks */
  .prose, article p, .text-serif {
    font-family: 'Lora', Georgia, serif;
  }

  /* Ensure Japanese text renders well */
  :lang(ja) {
    font-family: 'Noto Sans JP', 'Source Sans 3', system-ui, sans-serif;
  }

  :lang(ja) .prose, :lang(ja) article p {
    font-family: 'Noto Sans JP', 'Lora', serif;
  }

  /* Dark mode theme initialization */
  :root {
    color-scheme: light;
  }

  :root.dark {
    color-scheme: dark;
  }

  /* Smooth transitions - targeted to specific elements for better performance */
  a, button, .transition-colors, [class*="hover:"] {
    transition: color 0.2s ease, background-color 0.2s ease, border-color 0.2s ease;
  }

  /* Improved focus states for accessibility */
  *:focus-visible {
    outline: 2px solid #7d6ba2;
    outline-offset: 2px;
    border-radius: 2px;
  }

  /* Ensure links have visible focus */
  a:focus-visible {
    outline-color: #7d6ba2;
  }

  /* Better contrast for small text */
  .text-sm.text-warm-600 {
    color: #6b6560; /* Slightly darker for better readability */
  }

  .dark .text-sm.text-dark-600 {
    color: #a8a39a; /* Slightly lighter for better contrast in dark mode */
  }

</style>